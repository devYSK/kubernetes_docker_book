# í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì„±í•˜ê¸°


ì±…ì—ì„œëŠ” ì½”ë“œí˜• ì¸í”„ë¼ë¡œ ì¸í”„ë¼ í™˜ê²½ì„ ì¼ì •í•˜ê²Œ ìœ ì§€í•˜ê³  êµ¬ì„±

* ì½”ë“œí˜• ì¸í”„ë¼ : ì½”ë“œë¡œ í•˜ë“œì›¨ì–´ ì„¤ì •, ìš´ì˜ì²´ì œ ì„¤ì¹˜, ë„¤íŠ¸ì›Œí¬ êµ¬ì„±, ê°œë°œí™˜ê²½ êµ¬ì¶• 


# í…ŒìŠ¤íŠ¸ í™˜ê²½ì„ ìë™ìœ¼ë¡œ êµ¬ì„±í•˜ëŠ” ë„êµ¬ 

* ë² ì´ê·¸ëŸ°íŠ¸, ë²„ì¶”ì–¼ë°•ìŠ¤

### ë²„ì¶”ì–¼ë°•ìŠ¤ ì„¤ì¹˜

* ì´ë…¸í…Œí¬ì—ì„œ ê°œë°œí•œ ê°€ìƒí™” ì†Œí”„íŠ¸ì›¨ì–´ë¡œ ì˜¤ë¼í´ì—ì„œ ë°°í¬.
* ëŒ€ë¶€ë¶„ ìš´ì˜ì²´ì œë¥¼ ê²ŒìŠ¤íŠ¸ ìš´ì˜ì²´ì œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , í™•ì¥íŒ©ì„ ì œì™¸í•˜ë©´ ì•„ë¬´ì œí•œì—†ì´ SWì˜ ëª¨ë“  ê¸°ëŠ¥ ë¬´ë£Œ
* ë‹¤ë¥¸ ê°€ìƒí™” ì†Œí”„íŠ¸ì›¨ì–´ë³´ë‹¤ ê¸°ëŠ¥ì´ ê°•ë ¥í•˜ê³  ì•ˆì •ì  

### ë§¥(MAC OS)ì—ì„œ ì„¤ì¹˜

* https://www.virtualbox.org ë²„ì¶”ì–¼ë°•ìŠ¤ ê³µì‹ ì‚¬ì´íŠ¸ ì ‘ì†
* ![](images/3a6c0859.png) 
  * Download í´ë¦­
* ![](images/51f989a7.png)
  * OS X hosts í´ë¦­í•˜ì—¬ ë‹¤ìš´ë¡œë“œ  
  * ë‹¤ìš´ë¡œë“œ í›„ pkg íŒŒì¼ ì‹¤í–‰í•˜ì—¬ ì„¤ì¹˜.


### ë² ì´ê·¸ëŸ°íŠ¸ ì„¤ì¹˜

* https://www.vagrantup.com/downloads
* ì°¸ê³  : https://www.44bits.io/ko/post/vagrant-tutorial
* or 
```shell
brew tap hashicorp/tap
brew install vagrant
```

*ë² ì´ê·¸ëŸ°íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë„êµ¬ê°€ ì•„ë‹ˆë©°, ê°€ìƒ ë¨¸ì‹ ì„ ìƒì„±í•˜ê±°ë‚˜ ì¡°ì‘í•˜ëŠ” ê¸°ëŠ¥ì„ ì§ì ‘ ì œê³µí•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. ë² ì´ê·¸ëŸ°íŠ¸ì—ëŠ” í”„ë¡œë°”ì´ë”ë¼ëŠ” ê°œë…ì´ ìˆì–´ì„œ ë²„ì¶”ì–¼ë°•ìŠ¤VirtualBox, VMWare, ë„ì»¤Docker, Hyper-Vì™€ ê°™ì€ ë„êµ¬ë“¤ì„ ê°€ìƒ ë¨¸ì‹ ì„ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ë¡œ ì¡°í•©í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.*

* ì´ëŸ¬í•œ íŠ¹ì§•ì€ ì´í›„ì— ê°œë°œëœ í•˜ì‹œì½”í”„ ë„êµ¬ë“¤ì—ì„œë„ ì°¾ì•„ë³¼ ìˆ˜ ìˆëŠ” ë§¤ìš° ì¤‘ìš”í•œ ì»¨ì…‰ì…ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ë¥¼ ì½”ë“œë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í…Œë¼í¼ì—ëŠ” í”„ë¡œë°”ì´ë” ê°œë…ì´ ìˆìŠµë‹ˆë‹¤. AWS í”„ë¡œë°”ì´ë”, GCP í”„ë¡œë°”ì´ë”, Azure í”„ë¡œë°”ì´ë” ë“± ë©”ì´ì € í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•  ë¿ë§Œ ì•„ë‹ˆë¼ í…Œë¼í¼ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ì˜ í”„ë¡œë°”ì´ë”ê°€ ê°œë°œë˜ê³  ìˆìŠµë‹ˆë‹¤.

* ë² ì´ê·¸ëŸ°íŠ¸ëŠ” ê³µì‹ì ìœ¼ë¡œ ë§¥OS*, ìœˆë„ìš°, ë¦¬ëˆ…ìŠ¤ë¥¼ ì§€ì›í•˜ë©°, ë‹¤ìš´ë¡œë“œ í˜ì´ì§€ì—ì„œ ìš´ì˜ì²´ì¬ ë³„ ìµœì‹  ë²„ì „ì„ ë‹¤ìš´ë¡œë“œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ í•˜ì‹œì½”í”„ ë¦´ë¦¬ìŠ¤ í˜ì´ì§€ì—ì„œ ê³¼ê±° ë²„ì „ë“¤ì„ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

* 2021ë…„ 1ì›” í˜„ì¬ ì• í”Œ ì‹¤ë¦¬ì½˜ M1 ê¸°ë°˜ì˜ ë§¥ë¶ì—ì„œëŠ” ê°€ìƒ ë¨¸ì‹  ë„êµ¬ë“¤ì´ ì§€ì›í•˜ì§€ ì•Šì•„ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©ì´ ë¶ˆê°€ëŠ¥í•œ ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

#### ìì£¼ ì‚¬ìš©í•˜ëŠ” ë² ì´ê·¸ëŸ°íŠ¸ ëª…ë ¹ì–´
* vagrant init : í”„ë¡œë¹„ì €ë‹ì„ ìœ„í•œ ê¸°ì´ˆ íŒŒì¼ ìƒì„±
* vagrant up : Vagrantfileì„ ì½ì–´ ë“¤ì—¬ í”„ë¡œë¹„ì €ë‹ì„ ì§„í–‰
* vagrant halt : ë² ì´ê·¸ëŸ°íŠ¸ì—ì„œ ë‹¤ë£¨ëŠ” ê°€ìƒ ë¨¸ì‹  ì¢…ë£Œ
* vagrant destroy : ê´€ë¦¬í•˜ëŠ” ê°€ìƒ ë¨¸ì‹  ì‚­ì œ
* vagrant ssh : ê´€ë¦¬í•˜ëŠ” ê°€ìƒ ë¨¸ì‹ ì— sshë¡œ ì ‘ì†
* vagrant provision : ê´€ë¦¬í•˜ëŠ” ê°€ìƒ ë¨¸ì‹ ì— ë³€ê²½ëœ ì„¤ì • ì ìš©

### ë² ì´ê·¸ëŸ°íŠ¸ êµ¬ì„± ë° í…ŒìŠ¤íŠ¸
ë² ì´ê·¸ëŸ°íŠ¸ í”„ë¡œë¹„ì €ë‹ ì½”ë“œë¥¼ ê°œì¸ì´ ì›í•˜ëŠ” ìœ„ì¹˜í•´ êµ¬í˜„í•´ ì‚¬ìš© ê°€ëŠ¥.  
ë””ë ‰í† ë¦¬ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ê·¸ ì•ˆì— êµ¬ì„±í•´ë´„.  

1. ë””ë ‰í† ë¦¬ì—ì„œ vagrant init ëª…ë ¹ì„ ì‹¤í–‰í•´ í”„ë¡œë¹„ì €ë‹ì— í•„ìš”í•œ ê¸°ë³¸ ì½”ë“œ ìƒì„±
  * Vagrantfileì´ í•˜ë‚˜ ìƒê¹€

2. Vagrantfileì„ ì—ë””í„° í”„ë¡œê·¸ë¨ì´ë‚˜ vi/vimìœ¼ë¡œ ì—´ê³  íŒŒì¼ì—ì„œ config.vm.box = "base"ë¼ëŠ” ë‚´ìš©ì´ ìˆëŠ”ì§€ í™•ì¸ 
  * 10~17ì¤„ ì‚¬ì´ì—ìˆìŒ

3. https://app.vagrantup.com/boxes/searchì— ì ‘ì†í•˜ì—¬ ê°€ìƒì´ë¯¸ì§€ë¥¼ ë°›ì•„ì•¼í•¨
  * ê²€ìƒ‰ì°½ì— sysnet4adminì„ ê²€ìƒ‰í•˜ë©´ ì €ìê°€ ì˜¬ë ¤ë‘” íŒŒì¼ì´ ë³´ì„ 
  * CentOs-k8s 
4. config.vm.box = "base" ë¥¼ config.vm.box = "sysnet4admin/CentOS-k8s"ë¡œ ë³€ê²½ í›„ ì €ì¥(wq!)

5. vagrant up ëª…ë ¹ì–´ ì‹¤í–‰ í›„ ê°€ìƒ ë¨¸ì‹  ì´ë¯¸ì§€ë¥¼ ë‚´ë ¤ë°›ëŠ”ì§€ í™•ì¸ 

* `Vagrant was unable to mound VirtualBox shared folders' ì˜¤ë¥˜ëŠ” ë²„ì¶”ì–¼ë°•ìŠ¤ ê²ŒìŠ¤íŠ¸ ì—ë””ì…˜ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•„ì„œ ë°œìƒí•œ ì—ëŸ¬
  * í¬ê²Œ ì‹ ê²½ ì•ˆì¨ë„ëœë‹¤.  
```shell
 ysk ğŸ¸  î‚° ~/Documents/study/kubernetes/vagrant_ys î‚° vagrant up
Bringing machine 'default' up with 'virtualbox' provider...
==> default: Box 'sysnet4admin/CentOS-k8s' could not be found. Attempting to find and install...
    default: Box Provider: virtualbox
    default: Box Version: >= 0
==> default: Loading metadata for box 'sysnet4admin/CentOS-k8s'
    default: URL: https://vagrantcloud.com/sysnet4admin/CentOS-k8s
==> default: Adding box 'sysnet4admin/CentOS-k8s' (v0.7.4) for provider: virtualbox
    default: Downloading: https://vagrantcloud.com/sysnet4admin/boxes/CentOS-k8s/versions/0.7.4/providers/virtualbox.box
==> default: Successfully added box 'sysnet4admin/CentOS-k8s' (v0.7.4) for 'virtualbox'!
==> default: Importing base box 'sysnet4admin/CentOS-k8s'...
==> default: Matching MAC address for NAT networking...
==> default: Checking if box 'sysnet4admin/CentOS-k8s' version '0.7.4' is up to date...
==> default: Setting the name of the VM: vagrant_ys_default_1629429732397_28423
Vagrant is currently configured to create VirtualBox synced folders with
the `SharedFoldersEnableSymlinksCreate` option enabled. If the Vagrant
guest is not trusted, you may want to disable this option. For more
information on this option, please refer to the VirtualBox manual:

  https://www.virtualbox.org/manual/ch04.html#sharedfolders

This option can be disabled globally with an environment variable:

  VAGRANT_DISABLE_VBOXSYMLINKCREATE=1

or on a per folder basis within the Vagrantfile:

  config.vm.synced_folder '/host/path', '/guest/path', SharedFoldersEnableSymlinksCreate: false
==> default: Clearing any previously set network interfaces...
==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
==> default: Forwarding ports...
    default: 22 (guest) => 2222 (host) (adapter 1)
==> default: Booting VM...
There was an error while executing `VBoxManage`, a CLI used by Vagrant
for controlling VirtualBox. The command and stderr is shown below.

Command: ["startvm", "f3552f54-1d21-4ae1-a29a-30984055ba1b", "--type", "headless"]

Stderr: VBoxManage: error: The virtual machine 'vagrant_ys_default_1629429732397_28423' has terminated unexpectedly during startup with exit code 1 (0x1)
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component MachineWrap, interface IMachine

 âœ˜ ysk ğŸ¸  î‚° ~/Documents/study/kubernetes/vagrant_ys î‚°
```

6. ì„¤ì¹˜ê°€ ëë‚˜ë©´ ë²„ì¶”ì–¼ë°•ìŠ¤ë¥¼ ì‹¤í–‰í•´ ê°€ìƒ ë¨¸ì‹ ì´ ì œëŒ€ë¡œ ìƒì„±ëëŠ”ì§€ í™•ì¸ 
  * Kernel driver not installed (rc=-1908) ì˜¤ë¥˜ê°€ ë‚ ì‹œì— ì•„ë˜ ì°¸ê³ 
  * https://hyunsoft.tistory.com/207
7. ëª…ë ¹ í”„ë¡¬í”„íŠ¸(í„°ë¯¸ë„)ë¡œ ëŒì•„ì™€ vagrant ssh ëª…ë ¹ì„ ì‹¤í–‰í•´ ì„¤ì¹˜ëœ CentOSì— ì ‘ì† 

8. ì ‘ì†í•´ì„œ uptimeê³¼ cat /etc/redhat-release ëª…ë ¹ì–´ë¡œ ì œëŒ€ë¡œ ì„¤ì¹˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸

9. ê°€ìƒ ë¨¸ì‹ ì„ ë‚˜ì˜¬ë•ŒëŠ” exit ëª…ë ¤ì–´ ì‚¬ìš©. ë‹¤ìŒ í„°ë¯¸ë„ì—ì„œ ê°€ìƒë¨¸ì‹  ì‚­ì œë¥¼ ìœ„í•´ vagrant detroy -fë¥¼ ì‹¤í–‰. (-fëŠ” ê°•ì œì¢…ë£Œ ì˜µì…˜)


# ë² ì´ê·¸ëŸ°íŠ¸ë¡œ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•í•˜ê¸°

* ë² ì´ê·¸ëŸ°íŠ¸ ì½”ë“œëŠ” ë£¨ë¹„ ì–¸ì–´ë¡œ ì‘ì„±í•œë‹¤.
* ì›í•˜ëŠ” êµ¬ì„±ì„ ìë™ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ìˆë˜ë¡ Vagrantfiledì„ ìƒˆë¡­ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë”°. 
```
Vagrant.configure("2") do |config|
    config.vm.define "m-k8s" do |cfg|
        cfg.vm.box = "sysnet4admin/CentOS-k8s"
        cfg.vm.provider "virtualbox" do |vb|
            vb.name = "m-k8s(github_SysNet4Admin)"
            vb.cpus = 2
            vb.memory = 2048
            vb.customize ["modifyvm", :id, "--groups", "/k8s-SM(github_SysNet4Admin)"]
        end
        cfg.vm.host_name = "m-k8s"
        cfg.vm.network "private_network", ip: "192.168.1.10"
        cfg.vm.network "forwarded_port", guest:22, host: 60010, auto_correct: true, id: "ssh"
        cfg.vm.synced_folder "../data", "/vagrant", disabled: true
    end
end
```

### ê°€ìƒ ë¨¸ì‹ ì— ì¶”ê°€ íŒ¨í‚¤ì§€ ì„¤ì¹˜í•˜ê¸°

* Vargrantfileì— ì¶”ê°€ 
  * cfg.vm.provision "shell", path: "install_pkg.sh" #add provisioning script

* Vagrantfileì´ ìœ„ì¹˜í•œ ë””ë ‰í„°ë¦¬ì—ì„œ ì¶”ê°€ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•˜ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•˜ê³  install_pkg.shë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì €ì¥ 

* install_pkg.sh
```shell
#!/usr/bin/env bash
# install packages
yum install epel-release -y
yum install vim-enhanced -y
```

## ê°€ìƒë¨¸ì‹  ì—¬ëŸ¬ëŒ€ êµ¬ì„±
* Vagrantfile
```shell
Vagrant.configure("2") do |config|
    config.vm.define "m-k8s" do |cfg|
        cfg.vm.box = "sysnet4admin/CentOS-k8s"
        cfg.vm.provider "virtualbox" do |vb|
            vb.name = "m-k8s(github_SysNet4Admin)"
            vb.cpus = 2
            vb.memory = 2048
            vb.customize ["modifyvm", :id, "--groups", "/k8s-SM(github_SysNet4Admin)"]
        end
        cfg.vm.host_name = "m-k8s"
        cfg.vm.network "private_network", ip: "192.168.1.10"
        cfg.vm.network "forwarded_port", guest:22, host: 60010, auto_correct: true, id: "ssh"
        cfg.vm.synced_folder "../data", "/vagrant", disabled: true
        cfg.vm.provision "shell", path: "install_pkg.sh" #add provisioning script
        cfg.vm.provision "file", source: "ping_2_nds.sh", destination: "ping_2_nds.sh"
        cfg.vm.provision "shell", path: "config.sh" #add provisioning script

    end


    #===========#
    # Add Nodes #
    #===========#
    (1..3).each do |i| # 1ë¶€í„° 3ê¹Œì§€ 3ê°œì˜ ì¸ìë¥¼ ë°˜ë³µí•´ ië¡œì…ë ¥
      config.vm.define "w#{i}-k8s" do |cfg| # {i}ê°’ì´ ì°¨ë¡€ëŒ€ë¡œ ì¹˜í™˜ë¨
        cfg.vm.box = "sysnet4admin/CentOS-k8s"
        cfg.vm.provider "virtualbox" do |vb|
          vb.name = "w#{i}-k8s(github_SysNet4Admin)"
          vb.cpus = 1
          vb.memory = 1024
          vb.customize ["modifyvm", :id, "--groups", "/k8s-SM(github_SysNet4Admin)"]
        end
        cfg.vm.host_name = "w#{i}-k8s"
        cfg.vm.network "private_network", ip: "192.168.1.10#{i}"
        cfg.vm.network "forwarded_port", guest:22, host: "6010#{i}", auto_correct: true, id: "ssh"
        cfg.vm.synced_folder "../data", "/vagrant", disabled:true
        cfg.vm.provision "shell", path: "install_pkg.sh"
      end
    end
end

```
